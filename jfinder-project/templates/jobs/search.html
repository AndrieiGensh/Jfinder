{% extends "base.html" %}
{% load static %} 
{% load widget_tweaks %} 

{% block header %}

{% include "jobs/components/search_header.html" %}

{% endblock header %}

{% block content %}

<main class="w-full grid grid-cols-12 gap-6 p-6 max-h-[calc(100vh-120px)]">
    
    <!-- Filters Sidebar -->
    <aside class="col-span-2 bg-white rounded-xl shadow-md p-4 overflow-y-auto">
      <h3 class="text-lg font-semibold mb-4">Filters</h3>
      <div class="flex gap-2 mb-4">
        <button class="flex-1 bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700">Apply All</button>
        <button class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-md hover:bg-gray-300">Clear</button>
      </div>

      <div>
        <h4 class="font-medium text-sm mb-2">Tags</h4>
        <div class="flex flex-wrap gap-2">
          <span class="px-3 py-1 text-sm bg-gray-200 rounded-full cursor-pointer hover:bg-blue-100">Django</span>
          <span class="px-3 py-1 text-sm bg-gray-200 rounded-full cursor-pointer hover:bg-blue-100">HTML</span>
          <span class="px-3 py-1 text-sm bg-gray-200 rounded-full cursor-pointer hover:bg-blue-100">CSS</span>
          <span class="px-3 py-1 text-sm bg-gray-200 rounded-full cursor-pointer hover:bg-blue-100">PHP</span>
          <span class="px-3 py-1 text-sm bg-gray-200 rounded-full cursor-pointer hover:bg-blue-100">DevOps</span>
        </div>
      </div>

      <div class="mt-6 space-y-2">
        <button class="w-full border border-gray-300 rounded-md py-2 hover:bg-gray-100">Entry level</button>
        <button class="w-full border border-gray-300 rounded-md py-2 hover:bg-gray-100">Salary</button>
        <button class="w-full border border-gray-300 rounded-md py-2 hover:bg-gray-100">Benefits</button>
      </div>
    </aside>

    <!-- Job List -->
    <section id="job-list" class="col-span-4 bg-white rounded-xl shadow-md p-4 overflow-y-auto">
      <h3 class="text-lg font-semibold mb-4">Job Listings</h3>
      
      <!-- Job Card -->
      {% for offer in offer_list %}
      <div class="p-[3px] mb-4 rounded-xl">
        <article class="p-4 rounded-lg shadow-sm bg-white hover:shadow-md cursor-pointer"
        hx-get="/jobs/job-details/{{offer.id}}" hx-target="#job-details" hx-swap="innetHTML" hx-trigger="getJobDetails" 
        _="on click trigger getJobDetails on me then remove .offer-focus from <div/> in #job-list then add .offer-focus to the closest parent <div/>"
        >
          <h4 class="text-lg font-bold">{{offer.title}}</h4>
          <div class="flex flex-wrap gap-2 text-sm text-gray-500 mb-2">
              {% if offer.tags.all|length > 5 %}
                  {% for tag in offer.tags.all|slice:":4" %}
                      {% if forloop.first %}
                          <span>{{tag}}</span>
                      {% else %}
                          路 <span>{{tag}}</span>
                      {% endif %}
                  {% endfor %}
              {% else %}
                  {% for tag in offer.tags.all|slice:":4" %}
                      {% if forloop.first %}
                          <span>{{tag}}</span>
                      {% else %}
                          路 <span>{{tag}}</span>
                      {% endif %}
                  {% endfor %}
              {% endif %}
            {% comment %} <span>Django</span> 路 <span>HTML</span> 路 <span>Celery</span> {% endcomment %}
          </div>
          <p class="h-10 text-sm overflow-hidden text-ellipsis text-gray-600">{{offer.description}}</p>
        </article>
      </div>
      {% endfor %}
    </section>

    <!-- Job Details -->
    <section id="job-details" class="col-span-6 bg-white rounded-xl shadow-md p-6 overflow-y-auto">
      {% comment %} <div class="flex items-center gap-4 mb-4">
        <div class="w-16 h-16 bg-gray-200 rounded-md"></div>
        <div>
          <h2 class="text-xl font-bold">Long job title goes here for the testing 1</h2>
          <p class="text-gray-500">Company Sp. z o.o.</p>
        </div>
        <a href="{% url 'job_details_full' %}">Click</a>
      </div>

      <div class="max-w-none">
        <h3 class="text-lg font-semibold">Job description</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. In vel eros turpis. Sed mattis risus a velit lobortis...</p>

        <h3 class="text-lg font-semibold mt-4">Requirements</h3>
        <ul class="list-disc list-inside text-gray-700">
          <li>Requirement 1</li>
          <li>Requirement 2</li>
          <li>Requirement 3</li>
        </ul>

        <h3 class="text-lg font-semibold mt-4">Nice to have</h3>
        <ul class="list-disc list-inside text-gray-700">
          <li>Requirement A</li>
          <li>Requirement B</li>
        </ul>

        <h3 class="text-lg font-semibold mt-4">Benefits</h3>
        <ul class="list-disc list-inside text-gray-700">
          <li>Flexible hours</li>
          <li>Remote work</li>
          <li>Health insurance</li>
        </ul>

        <h3 class="text-lg font-semibold mt-4">Requirements</h3>
        <ul class="list-disc list-inside text-gray-700">
          <li>Requirement 1</li>
          <li>Requirement 2</li>
          <li>Requirement 3</li>
        </ul>

        <h3 class="text-lg font-semibold mt-4">Nice to have</h3>
        <ul class="list-disc list-inside text-gray-700">
          <li>Requirement A</li>
          <li>Requirement B</li>
        </ul>

        <h3 class="text-lg font-semibold mt-4">Benefits</h3>
        <ul class="list-disc list-inside text-gray-700">
          <li>Flexible hours</li>
          <li>Remote work</li>
          <li>Health insurance</li>
        </ul>

        <h3 class="text-lg font-semibold mt-4">Requirements</h3>
        <ul class="list-disc list-inside text-gray-700">
          <li>Requirement 1</li>
          <li>Requirement 2</li>
          <li>Requirement 3</li>
        </ul>

        <h3 class="text-lg font-semibold mt-4">Nice to have</h3>
        <ul class="list-disc list-inside text-gray-700">
          <li>Requirement A</li>
          <li>Requirement B</li>
        </ul>

        <h3 class="text-lg font-semibold mt-4">Benefits</h3>
        <ul class="list-disc list-inside text-gray-700">
          <li>Flexible hours</li>
          <li>Remote work</li>
          <li>Health insurance</li>
        </ul>
      </div> {% endcomment %}
      {% include "jobs/components/job_details_initial.html" %}
    </section>
</main>

{% comment %} <div id="main-wrapper" class="main-wrapper">
    <div class="search-container">
        <p class="font-primary text-black text-sm text-center">Search</p>
        <input
            type="text"
            form="filtered-form"
            class="h-8 border-secondary border-[1px] text-left pl-5 rounded-[5px] focus:border-primary focus:ring-0 focus:outline-none min-w-[5rem] w-1/4"
            placeholder="Search..."
            name="search_keyword"
        />
        <input
            type="submit"
            value="Search"
            form="filtered-form"
            class="h-7 bg-primary font-secondary border-primary border-2 text-sm text-white text-center rounded-2xl shadow-md transition-all duration-400 hover:scale-102 hover:ease-in-out min-w-[80px]"
        />
        <p class="font-primary text-black text-sm text-center">Country:</p>
        <select name="job-location-country" id="" form="filtered-form">
            <option value="a">Poland</option>
            <option value="a">Brazil</option>
            <option value="a">Ukraine</option>
            <option value="a">Russia</option>
            <option value="a">Spain</option>
        </select>
        <p class="font-primary text-black text-sm text-center">City:</p>
        <select name="job-location-city" id="" form="filtered-form">
            <option value="a">City 1</option>
            <option value="a">City 2</option>
            <option value="a">City 3</option>
            <option value="a">City 4</option>
            <option value="a">City 5</option>
        </select>
    </div>
    <div id="sidebar-container" class="sidebar-container">
        <aside class="sidebar-filters shrink-0 font-secondary">
            <div
                id="filters-controls"
                class="w-full shrink-0 sticky top-0 flex flex-col gap-2 justify-center bg-white px-[5px] py-[10px]"
            >
                <p class="text-center font-primary text-[16px]">Filters</p>
                <div class="w-full flex flex-row gap-2 justify-around">
                    <input
                        type="button"
                        value="Apply All"
                        class="bg-primary font-secondary text-white text-sm text-center h-7 w-[7rem] rounded-2xl"
                    />
                    <input
                        type="submit"
                        form="filtered-form"
                        value="Apply All"
                        class="bg-white border-1 border-secondary font-secondary text-secondary text-sm text-center h-7 w-[7rem] rounded-2xl"
                    />
                </div>
            </div>
            <div id="filters-container" class="w-full shrink-0">
                <div
                    class="bg-white flex flex-row justify-around items-center w-full h-8 border-primary border-1"
                    _="on click if event's target is me toggle .show on next <div/>"
                >
                    <p>Tags</p>
                    <input
                        type="text"
                        name=""
                        id=""
                        placeholder="Search"
                        class="w-1/2 h-6 text-center border-1 border-black"
                        _="on keyup if the event's key is 'Escape'
                            set my value to ''
                            trigger keyup
                            else show <div/> in #filter-list-wrapper when its textContent.toLowerCase() contains my value.toLowerCase()"
                    />
                </div>
                <div id="filter-list-wrapper" class="hidden w-full">
                    <form hx-get="{% url "search" %}" hx-params="*" hx-push-url="true" hx-target="#offers-list" hx-swap="innerHTML" id="filtered-form" 
                    class="w-full flex flex-wrap gap-3 py-4 max-h-[10rem] overflow-x-auto">
                        {% csrf_token %}
                        {% for tag in tag_list%}
                            <div 
                                class="min-h-5 px-[1rem] py-[0.1rem] text-center rounded-2xl bg-gray-300 cursor-pointer font-secondary {% if tag.selected %}{{'mimic-checkbox-checked'}}{% endif %}"
                                _="on click if event's target is me toggle [@checked] on (<input/> in me) then toggle .mimic-checkbox-checked on me"
                            >
                                {{tag.data.title}}
                                <input type="checkbox" name="tags" value="{{tag.data.slug}}" {% if tag.selected %}checked{% endif %} hidden>
                            </div>
                        {% endfor %}
                    </form>
                </div>
                <div
                    class="bg-white flex flex-row justify-around items-center w-full h-8 border-primary border-1"
                    _="on click toggle .show on next <div/>"
                >
                    <p>Entry level</p>
                </div>
                <div class="hidden w-full h-full">
                    {% include "jobs/components/nothing_here_list.html" %}
                </div>
                <div
                    class="bg-white flex flex-row justify-around items-center w-full h-8 border-primary border-1"
                >
                    <p>Salary</p>
                </div>
                <div
                    class="bg-white flex flex-row justify-around items-center w-full h-8 border-primary border-1"
                >
                    <p>Benefits</p>
                </div>
            </div>
        </aside>

        <aside id="job-details" class="side-details gap-5 pb-[1rem]">
            {% include "jobs/components/job_details_initial.html" %}
        </aside>
    </div>
    <main id="offers-list" class="main-content">
        {% include "jobs/components/job_list.html" %}
    </main>
</div> {% endcomment %}

{% endblock content %}
